
<meta charset="utf-8" emacsmode="-*- markdown -*-">
<link rel="stylesheet" href="https://casual-effects.com/markdeep/latest/slate.css?">

# Nebulator

![MarkS][marks.jpg]

It's called Nebulator after a MarkS C++ noisemaker called Nebula which allowed manipulation of synth parameters using code.

## Usage
- Top pane is the global transport control and channel controls.
- Bottom pane is log and comm tracing. Note that comm tracing has an impact on performance so use it judiciously.
- Basically open a .neb file, press compile, then run.
- Rather than spending the effort on a built-in script editor, use your favorite external text editor. The application will watch for
  changes you make and indicate that recompile is needed. I use Sublime - you can associate .neb files with C# for pretty-close syntax coloring.


## Example Script Files
See the Examples directory for material while perusing the docs.

File        | Description
----------- | -----------
example.neb | Source file showing example of static sequence and loop definitions, and creating notes by script functions.
airport.neb | My take on Eno's Music for Airports - from [this](https://github.com/teropa/musicforairports.js).
utils.neb   | Example of a library file for simple functions.
scale.neb   | Example of a library file for playing with a scale.
*.nebp      | Storage for dynamic stuff. This is created and managed by the application and not generally manually edited.
temp\\\*.cs | Generated C# files which are compiled and executed.
example.mp3 | A bit of some generated sound (not music!) using Reaper with good instruments and lots of reverb. I like lots of reverb.
airport.mp3 | Snippet generated by airport.neb and Reaper.



<!-- This can appear anywhere in the document. -->
[marks.jpg]: data:image/jpg;base64,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



# Script Syntax

This section describes the general structure and syntax rules of script files.  

Script functions are very C#-like because essentially it is C# (without stuff like namespaces). The compiler adds in the surrounding boilerplate and compiles the whole mess in memory where it executes.  

You can clean up your script file using [AStyle](http://astyle.sourceforge.net/).
```
AStyle --style=allman <your-file>
```

## General
Double slash `//` is used for comments. C style `/* ... */` is not supported.  

Names cannot have spaces or begin with a number.  


## Classes
Classes are supported (see `scale.neb`).
```c#
class klass
{
    public void DoIt(int val)
    {
        Print("DoIt got:", val);
    }
}    
```


# Script API

What the script supports.

## Basics

### Time
Time is described as a fixed point value `Beat.Subdiv` where:
- Beat as in the traditional definition = quarter note. From 0 to N.
- `Subdiv` is the subdivision of `Beat`.
- `Time.SubdivsPerBeat` defaults to 8 but you can change it if you dare.

Neb doesn't care about measures, that's up to you.

Previous incarnations used a floating point number instead of the `Time` class but this caused some annoying edge conditions.

Some pieces work better with absolute time so scripts have access to a `Now` property that supplies the number of seconds since the start button was pressed.

### Devices and Protocols
Midi and OSC are supported by Nebulator (or at least reasonable subsets). Devices are specified in the settings file:

- MidiIn: Midi in port name you have available.
- MidiOut: Midi out port name you have available.
- OscIn: Local port number.
- OscOut: As `127.0.0.1:1234` where `127.0.0.1` is the endpoint IP and `1234` is the port number.
- Vkey: Virtual keyboard, handled internally.

The Settings... menu will show you the devices on your computer.

Since the built-in Windows GM player sounds terrible, there are a couple of options for playing midi locally:

- Replace it with [virtualmidisynth](https://coolsoft.altervista.org/en/virtualmidisynth) and your favorite soundfont.
- If you are using a DAW for sound generation, you can use a virtual midi loopback like [loopMIDI](http://www.tobias-erichsen.de/software/loopmidi.html) to send to it.

### Musical Notes
Note groups are specified by strings like `"1 4 6 b13"` using `CreateNotes("FOO", "1 4 6 b13")`.

Notes (single) and note groups (chords, scales) are referenced in several ways:
- "F4" - Named note with octave.
- "F4.o7" - Named chord from [Chords](#musicdefinitions/chords) in the key of middle F.
- "F4.Aeolian" - Named scale from [Scales](#musicdefinitions/scales).
- "F4.FOO" - Custom chord or scale created with `CreateNotes()` see above
- SideStick - Drum name from [Drums](#musicdefinitions/generalmididrums).
- 57 - Simple midi note number.


## Directives

### Include
```c#
Include(utils.neb);
```

A simple include mechanism is supplied. It's pretty much an insert-whole-file-body-here, no wildcard support.
Tries absolute path first, then relative to current. It needs to be specified before contents are referenced.
If one were to get grandiose, a true import could be implemented.


### Channel
```c#
Channel("chname", device, chnum, volWobble)
```

Defines an output comm channel.

- chname: For display in the UI.
- device: Type of `MidiOut` or `OscOut`.
- chnum: Channel number to play on.
- volWobble: Optional value to add some randomization - from 0.0 to 1.0.


## Composition
A composition is comprised of Sections each of which has one or more Sequences.
You first create your Sequences like this:
```c#
Sequence CreateSequence(beats, elements[]);
```

Create a sequence of notes. There are several ways to do this. (This is a bit confusing but `example.neb`
should help clarify.)

- beats: Overall length in Beats.
- elements: 1 to N descriptors of what to play when. This can take several forms:
    - { when, which, volume, dur }
    - { when, drum, volume }
    - { when, function, volume }
    - { pattern, which, volume, dur }
    - { pattern, drum, volume }
        - when: When to play the element in the sequence, in `Beat.Subdiv` format.
        - which/drum: One of [Notes](#scriptapi/basics/musicalnotes) or [Drums](#musicdefinitions/generalmididrums).
        - volume: Note volume. Normalized to 0.0 - 1.0.
        - dur: Optional duration in `Beat.Subdiv` format e.g. 2.2. Drums and functions don't use duration.
        - function: Name of a defined function - executed at when.
        - pattern: describes a sequence of notes, kind of like a piano roll. `1 to 9` (volume) starts a note which is held 
          for subsequent `-`. The note is ended with any other character than `-`. `|`, `.` and ` ` are ignored, 
          used for visual assist only. These are particularly useful for drum patterns.
        

A nonsensical example:
```c#
NSequence seqKeysChorus = CreateSequence(2, new NSequenceElements
{
    { 0.0,  "F4",         0.7,   0.2 },
    { "|7--     7--     |7--     7--     |", "G4.m7",   KEYS_VOL,   1.2 },
    { 1.0,  RideCymbal1,  DRUM_VOL },
    { 1.2,  "B4.m7",      0.7,   0.3 },
    { 1.3,  MyAlgoFunc,   0.8 },
});
```

Then you group Sequences into Sections, typically things like verse, chorus, bridge, etc.
```c#
void CreateSection(beats, name, elements[]);
```

Create a defined section.

- beats: Overall length in beats.
- name: Displayed in time control while playing.
- elements: 1 to N descriptors of which sequences to play - { chname, mode, sequences[] }
    - chname: pertinent channel name
    - mode: Once or Loop for the measure
    - sequences: 1 to N sequences to play sequentially

An example:
```c#
CreateSection(16, "Middle", new SectionElements
{
    { "keys",  Loop,  seqKeysChorus },
    { "drums", Loop,  seqDrumsVerse },
    { "bass",  Loop,  seqBassVerse  },
    { "synth", Once,  seqAlgo,  seqEmpty, seqDynamic, seqEmpty }
});
```

## Runtime

### Properties
```c#
bool Playing
```
Indicates that script is executing. Read only.

```c#
Time StepTime
```
Current Nebulator step time object. Read only. Also use for StepTime.Beat and StepTime.subdiv.

```c#
double RealTime
```
Seconds since playing started. Read only.

```c#
double Speed
```
Nebulator speed in BPM. Read/write.

```c#
int MasterVolume
```
Nebulator master volume. Read/write.


### Callback Functions
These can be overridden in the user script.

```c#
public override void Setup()
```
Called once to initialize your script stuff.

```c#
public override void Step()
```
Called every Subdiv.

```c#
public override void InputNote(dev, chnum, note)
```
Called when input note arrives.

- dev: DeviceType.
- chnum: Channel number.
- note: Note number.

```c#
public override void InputControl(dev, chnum, ctlid, value)
```
Called when input controller arrives.

- dev: DeviceType.
- chnum: Channel number.
- ctlid: ControllerDef.
- value: Controller value.


### Send Functions
Call these from inside your script.

```c#
void SendNote("chname", note, vol, dur)
```
Send a note immediately. Respects solo/mute. Adds a note off to play after dur time.

- chname: Channel name to send it on.
- note: One of [Notes](#scriptapi/basics/musicalnotes).
- vol: Note volume. Normalized to 0.0 - 1.0. 0.0 means note off.
- dur: How long it lasts in Beat.Subdiv or Time object representation.

```c#
void SendNoteOn("chname", note, vol)
```
Send a note on immediately. Respects solo/mute. Doesn't add note off.

- chname: Channel name to send it on.
- note: One of [Notes](#scriptapi/basics/musicalnotes).
- vol: Note volume. Normalized to 0.0 - 1.0.

```c#
void SendNoteOff("chname", note)
```
Send a note off immediately.

- chname: Channel name to send it on.
- note: One of [Notes](#scriptapi/basics/musicalnotes).

```c#
void SendSequence("chname", seq, beat) 
```
Send a sequence in the future.

- chname: Channel name to send it on.
- seq: Which defined Sequence to send.
- beat: When to send.

```c#
void SendController("chname", ctl, val)
```
Send a controller immediately. Useful for things like panning and bank select.

- chname: Channel name to send it on.
- ctl: Controller from [Controllers](#musicdefinitions/midicontrollers) or const() or simple integer.
- val: Controller value.

```c#
void SendPatch("chname", patch)
```
Send a midi patch immediately. Really only needed if using the windows GM.

- chname: Channel name to send it on.
- patch: Instrument from [Instruments](#musicdefinitions/generalmidiinstruments).

### Utilities

```c#
void CreateNotes("name", "parts")
```
Define a group of notes for use as a note, or in a chord or scale.

- name: Reference name.
- note: List of [Notes](#scriptapi/basics/musicalnotes).

```c#
List<double> GetNotes("scale_or_chord", "key")
```
Get an array of scale notes.

- scale: One of the named scales from ScriptDefinitions.md or defined in `notes`.
- key: Note name and octave.
- returns: Array of notes or empty if invalid.



```c#
double Random(double max)
double Random(double min, double max)
int Random(int max)
int Random(int min, int max)
```
Various flavors of randomizers.


```c#
void Print(object arg, object arg, ...)
```
You know what this is.

# Internals

- VS 2019 solution, targets .NET5 WinForms.
- Uses Roslyn for in-memory compilation.
- No installer yet, it's a build-it-yerself for now. Eventually a nuget package might be created.
- Settings and log are in `C:\Users\<user>\AppData\Local\Ephemera\Nebulator`.

## Design

- Three projects. `Common` and `Script` are compiled separately into assemblies
  so that they can be linked with the compiled user script dynamically.
- Main UI and non user script stuff is all in the `App` project.
- Channels and Controllers follow the midi model. Devices represent ports (and corresponding physical dvices.)
- You can have up to 16 Channels attached to each IOutputDevice.
- There is one ChannelControl per Channel.


## Code Files

```
root
|   Nebulator.sln 
|   README.md
|   Nebulator.html (generated doc file)
|   version.txt (contains current version string)
|   mkdoc.py (builds Nebulator.html from DocFiles/*)
|   
+---App (main app and UI)
|   |   App.csproj
|   |   Program.cs
|   |   MainForm.*
|   |   Compiler.cs
|   |   Logging.cs
|   |   NLog.config
|   |               
|   +---UI (controls and forms)
|   |       ChannelControl.*
|   |       Keyboard.*
|   |       SettingsEditor.*
|   |       TimeControl.*
|   |       
|   +---Midi (midi I/O)
|   |       MidiInput.cs
|   |       MidiOutput.cs
|   |       MidiUtils.cs
|   |                   
|   +---OSC (OSC I/O)
|   |       OscCommon.cs
|   |       OscInput.cs
|   |       OscOutput.cs
|   |       
|   \---Resources
|           glyphicons-*.png
|           medusa.ico
|           
+---Common (separate assembly so it can be linked with the user script)
|       Common.csproj
|       Bag.cs
|       Channel.cs
|       IDevice.cs
|       MusicDefinitions.cs
|       Step.cs
|       StepCollection.cs
|       Time.cs
|       UserSettings.cs
|       Utils.cs
|       Wobbler.cs
|
+---Script (base class/assembly for user script)
|       Script.csproj
|       ScriptApi.cs
|       ScriptCore.cs
|       ScriptUtils.cs
|       Section.cs
|       Sequence.cs
|       
+---Examples (see  #nebulator/examplescriptfiles)
|           
+---lib (third party non-nuget)
|       
+---Test (pathetic test stuff)
|
\---DocFiles
        Nebulator.md
        ScriptSyntax.md
        ScriptApi.md
        Internals.md
        MusicDefinitions.md
```
      

## Bonus Stuff
This project contains a bunch of components that are either recycled or created for this. Chunks could be stripped out for subsequent reuse.

- Midi and OSC classes may be useful elsewhere in conjunction with NAudio.
- Embedded Roslyn in-memory compiler.
- Uses my [NBagOfTricks](https://github.com/cepthomas/NBagOfTricks) and [NBagOfUis](https://github.com/cepthomas/NBagOfUis).


## Third Party
This application uses these FOSS components.

- NAudio including modified controls and midi file utilities: [NAudio](https://github.com/naudio/NAudio) (Microsoft Public License).
- Logging: [NLog](http://nlog-project.org/) (BSD 3-Clause).
- Markdown rendering: [Markdeep](https://casual-effects.com/markdeep).
- Main icon: [Charlotte Schmidt](http://pattedemouche.free.fr/) (Copyright © 2009 of Charlotte Schmidt).
- Button icons: [Glyphicons Free](http://glyphicons.com/) (CC BY 3.0).



# Music Definitions

Definitions for use in Nebulator script functions.

## Chords
These are the built-in chords. You can add your own in your script.

Chord   | Notes             | Description
------- | ----------------- | -----------
M       | 1 3 5             | Named after the major 3rd interval between root and 3.
m       | 1 b3 5            | Named after the minor 3rd interval between root and b3.
7       | 1 3 5 b7          | Also called dominant 7th.
M7      | 1 3 5 7           | Named after the major 7th interval between root and 7th major scale note.
m7      | 1 b3 5 b7         |
6       | 1 3 5 6           | Major chord with 6th major scale note added.
m6      | 1 b3 5 6          | Minor chord with 6th major scale note added.
o       | 1 b3 b5           | Diminished.
o7      | 1 b3 b5 bb7       | Diminished added 7.
m7b5    | 1 b3 b5 b7        | Also called minor 7b5.
\+      | 1 3 #5            | Augmented.
7#5     | 1 3 #5 b7         |
9       | 1 3 5 b7 9        |
7#9     | 1 3 5 b7 #9       | The 'Hendrix' chord.
M9      | 1 3 5 7 9         |
Madd9   | 1 3 5 9           | Chords extended beyond the octave are called added when the 7th is not present.
m9      | 1 b3 5 b7 9       |
madd9   | 1 b3 5 9          |
11      | 1 3 5 b7 9 11     | The 3rd is often omitted to avoid a clash with the 11th.
m11     | 1 b3 5 b7 9 11    |
7#11    | 1 3 5 b7 #11      | Often used in preference to 11th chords to avoid the dissonant clash between 11 and 3 .
M7#11   | 1 3 5 7 9 #11     |
13      | 1 3 5 b7 9 11 13  | The 11th is often omitted to avoid a clash with the 3rd.
M13     | 1 3 5 7 9 11 13   | The 11th is often omitted to avoid a clash with the 3rd.
m13     | 1 b3 5 b7 9 11 13 |
sus4    | 1 4 5             |
sus2    | 1 2 5             | Sometimes considered as an inverted sus4 (GCD).
5       | 1 5               | Power chord.

## Scales
These are the built-in scales. You can add your own in your script.

Scale                         | Notes                        | Description                              | Lower tetrachord  | Upper tetrachord
----------------------------- | ---------------------------- | ---------------------------------------- | ----------------  | ------------------------
Acoustic                      | 1 2 3 #4 5 6 b7              | Acoustic scale                           | whole tone        | minor
Aeolian                       | 1 2 b3 4 5 b6 b7             | Aeolian mode or natural minor scale      | minor             | Phrygian
NaturalMinor                  | 1 2 b3 4 5 b6 b7             | Aeolian mode or natural minor scale      | minor             | Phrygian
Algerian                      | 1 2 b3 #4 5 b6 7             | Algerian scale                           |                   |
Altered                       | 1 b2 b3 b4 b5 b6 b7          | Altered scale                            | diminished        | whole tone
Augmented                     | 1 b3 3 5 #5 7                | Augmented scale                          |
Bebop                         | 1 2 3 4 5 6 b7 7             | Bebop dominant scale                     |                   |
Blues                         | 1 b3 4 b5 5 b7               | Blues scale                              |                   |
Chromatic                     | 1 #1 2 #2 3 4 #4 5 #5 6 #6 7 | Chromatic scale                          |                   |
Dorian                        | 1 2 b3 4 5 6 b7              | Dorian mode                              | minor             | minor
DoubleHarmonic                | 1 b2 3 4 5 b6 7              | Double harmonic scale                    | harmonic          | harmonic
Enigmatic                     | 1 b2 3 #4 #5 #6 7            | Enigmatic scale                          |                   |
Flamenco                      | 1 b2 3 4 5 b6 7              | Flamenco mode                            | Phrygian          | Phrygian
Gypsy                         | 1 2 b3 #4 5 b6 b7            | Gypsy scale                              | Gypsy             | Phrygian
HalfDiminished                | 1 2 b3 4 b5 b6 b7            | Half diminished scale                    | minor             | whole tone
HarmonicMajor                 | 1 2 3 4 5 b6 7               | Harmonic major scale                     | major             | harmonic
HarmonicMinor                 | 1 2 b3 4 5 b6 7              | Harmonic minor scale                     | minor             | harmonic
Hirajoshi                     | 1 3 #4 5 7                   | Hirajoshi scale                          |
HungarianGypsy                | 1 2 b3 #4 5 b6 7             | Hungarian Gypsy scale                    | Gypsy             | harmonic
HungarianMinor                | 1 2 b3 #4 5 b6 7             | Hungarian minor scale                    | Gypsy             | harmonic
In                            | 1 b2 4 5 b6                  | In scale                                 |                   |
Insen                         | 1 b2 4 5 b7                  | Insen scale                              |                   |
Ionian                        | 1 2 3 4 5 6 7                | Ionian mode or major scale               | major             | major
Istrian                       | 1 b2 b3 b4 b5 5              | Istrian scale                            |                   |
Iwato                         | 1 b2 4 b5 b7                 | Iwato scale                              |                   |
Locrian                       | 1 b2 b3 4 b5 b6 b7           | Locrian mode                             | Phrygian          | whole tone
LydianAugmented               | 1 2 3 #4 #5 6 7              | Lydian augmented scale                   | whole tone        | diminished
Lydian                        | 1 2 3 #4 5 6 7               | Lydian mode                              | whole tone        | major
Major                         | 1 2 3 4 5 6 7                | Ionian mode or major scale               | major             | major
MajorBebop                    | 1 2 3 4 5 #5 6 7             | Major bebop scale                        |                   |
MajorLocrian                  | 1 2 3 4 b5 b6 b7             | Major Locrian scale                      | major             | whole tone
MajorPentatonic               | 1 2 3 5 6                    | Major pentatonic scale                   |                   |
MelodicMinorAscending         | 1 2 b3 4 5 6 7               | Melodic minor scale (ascending)          | minor             | varies
MelodicMinorDescending        | 1 2 b3 4 5 b6 b7 8           | Melodic minor scale (descending)         | minor             | major
MinorPentatonic               | 1 b3 4 5 b7                  | Minor pentatonic scale                   |                   |
Mixolydian                    | 1 2 3 4 5 6 b7               | Mixolydian mode or Adonai malakh mode    | major             | minor
NeapolitanMajor               | 1 b2 b3 4 5 6 7              | Neapolitan major scale                   | Phrygian          | major
NeapolitanMinor               | 1 b2 b3 4 5 b6 7             | Neapolitan minor scale                   | Phrygian          | harmonic
Octatonic                     | 1 2 b3 4 b5 b6 6 7           | Octatonic scale (or 1 b2 b3 3 #4 5 6 b7) |                   |
Persian                       | 1 b2 3 4 b5 b6 7             | Persian scale                            | harmonic          | unusual
PhrygianDominant              | 1 b2 3 4 5 b6 b7             | Phrygian dominant scale                  | harmonic          | Phrygian
Phrygian                      | 1 b2 b3 4 5 b6 b7            | Phrygian mode                            | Phrygian          | Phrygian
Prometheus                    | 1 2 3 #4 6 b7                | Prometheus scale                         |                   |
Tritone                       | 1 b2 3 b5 5 b7               | Tritone scale                            |                   |
UkrainianDorian               | 1 2 b3 #4 5 6 b7             | Ukrainian Dorian scale                   | Gypsy             | minor
WholeTone                     | 1 2 3 #4 #5 #6               | Whole tone scale                         |                   |
Yo                            | 1 b3 4 5 b7                  | Yo scale                                 |                   |

## General Midi Instruments

Instrument          | Number
----------          | ------
AcousticGrandPiano  |  0
BrightAcousticPiano |  1
ElectricGrandPiano  |  2
HonkyTonkPiano      |  3
ElectricPiano1      |  4
ElectricPiano2      |  5
Harpsichord         |  6
Clavinet            |  7
Celesta             |  8
Glockenspiel        |  9
MusicBox            | 10
Vibraphone          | 11
Marimba             | 12
Xylophone           | 13
TubularBells        | 14
Dulcimer            | 15
DrawbarOrgan        | 16
PercussiveOrgan     | 17
RockOrgan           | 18
ChurchOrgan         | 19
ReedOrgan           | 20
Accordion           | 21
Harmonica           | 22
TangoAccordion      | 23
AcousticGuitarNylon | 24
AcousticGuitarSteel | 25
ElectricGuitarJazz  | 26
ElectricGuitarClean | 27
ElectricGuitarMuted | 28
OverdrivenGuitar    | 29
DistortionGuitar    | 30
GuitarHarmonics     | 31
AcousticBass        | 32
ElectricBassFinger  | 33
ElectricBassPick    | 34
FretlessBass        | 35
SlapBass1           | 36
SlapBass2           | 37
SynthBass1          | 38
SynthBass2          | 39
Violin              | 40
Viola               | 41
Cello               | 42
Contrabass          | 43
TremoloStrings      | 44
PizzicatoStrings    | 45
OrchestralHarp      | 46
Timpani             | 47
StringEnsemble1     | 48
StringEnsemble2     | 49
SynthStrings1       | 50
SynthStrings2       | 51
ChoirAahs           | 52
VoiceOohs           | 53
SynthVoice          | 54
OrchestraHit        | 55
Trumpet             | 56
Trombone            | 57
Tuba                | 58
MutedTrumpet        | 59
FrenchHorn          | 60
BrassSection        | 61
SynthBrass1         | 62
SynthBrass2         | 63
SopranoSax          | 64
AltoSax             | 65
TenorSax            | 66
BaritoneSax         | 67
Oboe                | 68
EnglishHorn         | 69
Bassoon             | 70
Clarinet            | 71
Piccolo             | 72
Flute               | 73
Recorder            | 74
PanFlute            | 75
BlownBottle         | 76
Shakuhachi          | 77
Whistle             | 78
Ocarina             | 79
Lead1Square         | 80
Lead2Sawtooth       | 81
Lead3Calliope       | 82
Lead4Chiff          | 83
Lead5Charang        | 84
Lead6Voice          | 85
Lead7Fifths         | 86
Lead8BassAndLead    | 87
Pad1NewAge          | 88
Pad2Warm            | 89
Pad3Polysynth       | 90
Pad4Choir           | 91
Pad5Bowed           | 92
Pad6Metallic        | 93
Pad7Halo            | 94
Pad8Sweep           | 95
Fx1Rain             | 96
Fx2Soundtrack       | 97
Fx3Crystal          | 98
Fx4Atmosphere       | 99
Fx5Brightness       | 100
Fx6Goblins          | 101
Fx7Echoes           | 102
Fx8SciFi            | 103
Sitar               | 104
Banjo               | 105
Shamisen            | 106
Koto                | 107
Kalimba             | 108
BagPipe             | 109
Fiddle              | 110
Shanai              | 111
TinkleBell          | 112
Agogo               | 113
SteelDrums          | 114
Woodblock           | 115
TaikoDrum           | 116
MelodicTom          | 117
SynthDrum           | 118
ReverseCymbal       | 119
GuitarFretNoise     | 120
BreathNoise         | 121
Seashore            | 122
BirdTweet           | 123
TelephoneRing       | 124
Helicopter          | 125
Applause            | 126
Gunshot             | 127

## General Midi Drums

Drum                | Number
----                | ------
AcousticBassDrum    | 35
BassDrum1           | 36
SideStick           | 37
AcousticSnare       | 38
HandClap            | 39
ElectricSnare       | 40
LowFloorTom         | 41
ClosedHiHat         | 42
HighFloorTom        | 43
PedalHiHat          | 44
LowTom              | 45
OpenHiHat           | 46
LowMidTom           | 47
HiMidTom            | 48
CrashCymbal1        | 49
HighTom             | 50
RideCymbal1         | 51
ChineseCymbal       | 52
RideBell            | 53
Tambourine          | 54
SplashCymbal        | 55
Cowbell             | 56
CrashCymbal2        | 57
Vibraslap           | 58
RideCymbal2         | 59
HiBongo             | 60
LowBongo            | 61
MuteHiConga         | 62
OpenHiConga         | 63
LowConga            | 64
HighTimbale         | 65
LowTimbale          | 66
HighAgogo           | 67
LowAgogo            | 68
Cabasa              | 69
Maracas             | 70
ShortWhistle        | 71
LongWhistle         | 72
ShortGuiro          | 73
LongGuiro           | 74
Claves              | 75
HiWoodBlock         | 76
LowWoodBlock        | 77
MuteCuica           | 78
OpenCuica           | 79
MuteTriangle        | 80
OpenTriangle        | 81

## Midi Controllers
- http://www.nortonmusic.com/midi_cc.html
- Undefined MIDI CCs: 3, 9, 14-15, 20-31, 85-90, 102-119
- For most controllers marked on/off, on=127 and off=0

Controller          | Number | Notes
----------          | ------ | -----
BankSelect          | 0      | MSB Followed by BankSelectLSB and Program Change
Modulation          | 1      |
BreathController    | 2      |
FootController      | 4      | MSB
PortamentoTime      | 5      | MSB Only use this for portamento time use 65 to turn on/off
Volume              | 7      | 7 and 11 both adjust the volume. Use 7 as your main control, set and forget
Balance             | 8      | MSB Some synths use it
Pan                 | 10     | MSB
Expression          | 11     | MSB See 7 - use 11 for volume changes during the track (crescendo, diminuendo, swells, etc.)
BankSelectLSB       | 32     | LSB
ModulationLSB       | 33     | LSB
BreathControllerLSB | 34     | LSB
FootControllerLSB   | 36     | LSB
PortamentoTimeLSB   | 37     | LSB
VolumeLSB           | 39     | LSB
BalanceLSB          | 40     | LSB
PanLSB              | 42     | LSB
ExpressionLSB       | 43     | LSB
Sustain             | 64     | Hold Pedal on/off
Portamento          | 65     | on/off
Sostenuto           | 66     | on/off
SoftPedal           | 67     | on/off
Legato              | 68     | on/off
Sustain2            | 69     | Hold Pedal 2 on/off
PortamentoControl   | 84     |
AllSoundOff         | 120    |
ResetAllControllers | 121    |
LocalKeyboard       | 122    |
AllNotesOff         | 123    |
NoteControl         | 250    | Special for internal use
PitchControl        | 251    | Special for internal use


## GM Drum Kits

Note that these will vary depending on your SF file.

Kit        | Number
-----------| ------
Standard   | 0
Room       | 8
Power      | 16
Electronic | 24
TR808      | 25
Jazz       | 32
Brush      | 40
Orchestra  | 48
SFX        | 56


<!-- Markdeep: -->
<style class="fallback">body{visibility:hidden} </style>
<script> markdeepOptions={tocStyle:'long'}; </script>
<script src="https://casual-effects.com/markdeep/latest/markdeep.min.js?" charset="utf-8" ></script>
# 